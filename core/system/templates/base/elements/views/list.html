{% extends 'base/layout.html' %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ category }}</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">{{ section }}</h5>
                    <div>
                        {% if action_headers %}
                            {% block ActionButtonsHeader %}
                                <button class="btn btn-primary" onclick="LoadForm();">
                                    <i class="fas fa-plus"></i> Nuevo registro
                                </button>
                                <button class="btn btn-success" id="updateBtn" onclick="window.location.reload()">
                                    <i class="fas fa-sync"></i> Actualizar
                                </button>
                            {% endblock %}
                        {% elif custom_action_headers %}
                            {% include custom_action_headers %}
                        {% endif %}
                    </div>
                </div>

                <div id="main_datatable_wrapper" class="dataTables_wrapper dt-bootstrap5">
                    <table id="main_datatable" class="table table-bordered table-striped dataTable">
                        <thead>
                            <tr>{% block rows %}{% endblock %}</tr>
                        </thead>
                        <tbody>{% block columns %}{% endblock %}</tbody>
                        <tfoot>
                            <tr>{% block rowsbottom %}{% endblock %}</tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="card-footer">
                {% block ActionButtons %}{% endblock %}
            </div>
        </div>
    </div>
</div>

{% include "base/elements/modal.html" %}
{% endblock %}

{% block scripts %}
    {% block load_form %}
        {% include "base/elements/js/LoadForm.html" %}
    {% endblock %}

    {% block datatable_import %}{% endblock %}
    {% block js %}{% endblock %}

    {% block modalAddScript %}
        {% include "base/elements/forms/submit.html" %}
    {% endblock %}

    {% block modalUpdateScript %}
        <script>
            $('#UpdateForm').on('submit', function (e) {
                e.preventDefault();
                const parameters = new FormData(this);
                submit_with_ajax(window.location.pathname, parameters, function (data) {
                    Swal.fire({ icon: 'success', title: 'Éxito', text: 'Actualización realizada' });
                    tblClient.ajax.reload(null, false);
                }, function (data) {
                    Swal.fire({ icon: 'error', title: 'Error', text: data.error });
                });
            });
        </script>
    {% endblock %}

    {% block modalDeleteScript %}
        <script>
            $('#DeleteForm').on('submit', function (e) {
                e.preventDefault();
                const parameters = new FormData(this);
                submit_with_ajax(window.location.pathname, parameters, function (data) {
                    Swal.fire({ icon: 'success', title: 'Éxito', text: 'Registro eliminado' });
                    tblClient.ajax.reload(null, false);
                }, function (data) {
                    Swal.fire({ icon: 'error', title: 'Error', text: data.error });
                });
            });
        </script>
    {% endblock %}
{% endblock %}